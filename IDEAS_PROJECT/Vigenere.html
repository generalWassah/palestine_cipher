<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vigenere Cipher</title>
    <link rel="stylesheet" href="styles/cipherVigenereStyle.css">
</head>
<body>
    <div class="container">
        <h1 id="cipher_type">Palestine Cipher</h1>
      
      <div class='func_implement_container'>
        
      <div class='functions_container'>
        <div>
         <input id='diffusion_option' type='checkbox' checked="true"> <span class='my-dif-imp-label'>Diffusion:</span>     
        </div>
        <div>
      <select id="mySelectFunc" name="newsfunctions">
        <option value="north_diffusion">North</option>
        <option value="north_odd_diffusion">NorthOdd</option>
        <option value="east_diffusion">East</option>
        <option value="east_odd_diffusion">EastOdd</option>   
        <option value="west_diffusion">West</option>
        <option value="west_odd_diffusion">WestOdd</option>    
        <option value="south_diffusion">South</option>
        <option value="south_odd_diffusion">SouthOdd</option>
      </select>
      </div>
      </div><!-- functions_container -->
        
      <div class="implementations_container">
         <div>
          <input id='implementation_option' type='checkbox' > <span class='my-dif-imp-label'>Implementation:</span>       
        </div>
      <div>
       <select id="mySelectImplement" name="newsImplementations" disabled="true">
        <option value="outward">OutWard</option>
        <option value="inward">InWard</option>
        <option value="rightward">RightWard</option>
        <option value="rightwardR">RightWardR</option>
        <option value="leftward">LeftWard</option>
        <option value="leftwardr">LeftWardR</option>
       </select>
      </div>
      </div><!-- implementation -->
        
      </div><!-- func_implement_container -->
        <div>
        <label class='my-label' for="input">Input:</label>
        <textarea class="main-inputs"  id="input" rows="5" placeholder="Enter plaintext or ciphertext"></textarea>
        </div>
         <div class="diff-orbit-inputs">
            <div>
             
                <label for='diffIndex'>S index:</label>
                <input id="diffIndex" type="number" min="0" />
             
            </div>
            <div>
            
               <label for='orbitIndex'>O index:</label>
               <input id='orbitIndex' type="number" min="1" />
              
            </div>
         </div>
        <div>
        <label class="my-label" for="key">Key:</label>
        <input class="main-inputs" type="text" id="key" placeholder="Enter the key">
        </div>
        
        <div class="buttons">
            <button onclick="encryptText()">Encrypt</button>
            <button onclick="decryptText()">Decrypt</button>
        </div>
        <div id='genKey'>
            <button onclick='showGeneratedKey()'>Show generated key</button>
        </div>
        <div>
          <label class="my-label" for="output">Output:</label>
          <textarea class="main-inputs"  id="output" rows="5" readonly></textarea>
        </div>
        <div><marquee id="my-marquee">V++ cipher active</marquee></div>
        <button onclick='test()'>K Click</button>
        </div>
  <!-- Vigenére cipher script -->
    <script src="scripts/myVigenere/cipherVigenereScript.js"></script>
  <!-- V++ cipher script -->
    <script src="scripts/myVPlusPlus/myVPlusPlus.js"></script>
  <!-- NEWS diffusion functions scripts -->
    <script src="scripts/news_diffusion_functions/northDiffusion.js"></script>
    <script src="scripts/news_diffusion_functions/northOddDiffusion.js"></script>
    <script src="scripts/news_diffusion_functions/eastDiffusion.js"></script>
    <script src="scripts/news_diffusion_functions/eastOddDiffusion.js"></script>
    <script src="scripts/news_diffusion_functions/westDiffusion.js"></script>
    <script src="scripts/news_diffusion_functions/westOddDiffusion.js"></script>
    <script src="scripts/news_diffusion_functions/southDiffusion.js"></script>
    <script src="scripts/news_diffusion_functions.js"></script>
  <!-- NEWS diffusion implementations scripts -->
    <script src="scripts/news_implementations/outWard.js"></script>
    <script src="scripts/news_implementations/inWard.js"></script>
    <script src="scripts/news_implementations/rightWard.js"></script>
    <script src="scripts/news_implementations/rightWardR.js"></script>
    <script src="scripts/news_implementations/leftWard.js"></script>
    <script src="scripts/news_implementations/leftWardR.js"></script>
    <script>   

alert('reached current');
   // implementation checkbox click event    
     let implementationOption = document.getElementById('implementation_option');

     implementationOption.addEventListener('click', function(){
       let impchecked = implementationOption.checked;
     if(impchecked==false){
       document.getElementById("mySelectImplement").disabled = true;
      }else{
       document.getElementById("mySelectImplement").disabled = false;
      }
     });// implementation option checkbox click event

    // diffusion option checkbox click event
     let diffusionOption = document.getElementById('diffusion_option');

      diffusionOption.addEventListener('click', function(){
       let dchecked = diffusionOption.checked;
     if(dchecked==false){
       document.getElementById("diffIndex").disabled = true;
       document.getElementById("orbitIndex").disabled = true;
       document.getElementById("mySelectFunc").disabled = true;
       document.getElementById("mySelectImplement").disabled = true;
       document.getElementById('implementation_option').checked = false;
       document.getElementById('implementation_option').disabled = true;
       document.getElementById('cipher_type').innerText = 'Vigenère Cipher';
       document.getElementById('my-marquee').innerText = 'Vigenère cipher active';
      }else{
       document.getElementById("diffIndex").disabled = false;
       document.getElementById("orbitIndex").disabled = false;
       document.getElementById("mySelectFunc").disabled = false;
       document.getElementById('implementation_option').disabled = false;
       document.getElementById('cipher_type').innerText = 'Palestine Cipher';
       document.getElementById('my-marquee').innerText = 'Palestine cipher active';
          
       }
        
     });// diffusion option checkbox click event
    
   document.getElementById('orbitIndex').value = 1;
   document.getElementById('diffIndex').value = 0;
        
    
    
    // Encryption function
    function encryptText(){
      
     // V++ Cipher Encryption using the NEWS functions and its implementations
      
      let dchecked = document.getElementById('diffusion_option').checked;
      let impchecked = document.getElementById('implementation_option').checked;
      
      let input = document.getElementById("input").value.trim();
      let key = document.getElementById("key").value.trim();
     
      if (!input || !key) {
             alert("Please enter both text and key.");
             return;
       }
        
   if(dchecked==true && impchecked==false){
       
     if(containsLetter(input) || containsLetter(key)){
         
         let lettersPln='';
         let northPTxt;
         let diffusedLetters;
         
         if(containsLetter(input)){
              lettersPln = getLetters(input);
              northPTxt = new North(lettersPln); 
              diffusedLetters = northPTxt.getOrbitAt(4, 0);
         }else{
             alert('Enter plaintext letter(s) to encrypt');            
         }
         
         let lettersKey='';
         let myExpandedLettersKey='';
         if(containsLetter(key)){
              lettersKey = getLetters(key);
              myExpandedLettersKey = getVPlusPlusKey(lettersKey);
         }else{
             alert('Enter letter(s) key to encrypt plaintext letters');            
         }
                   
       let myVppL;     
       let encryptedLetters = '';
       alert('reached letters');
       
         // diffuse the letters        
            myVppL = new VPlusPlus(diffusedLetters, myExpandedLettersKey);    
            alert('entered Letters: '+lettersPln.length);
            encryptedLetters = myVppL.getEncryptedLetters();
              
       } //containsLetter()
 
      if(containsDigit(input) || containsDigit(key)){
          
          let digitsPln='';
          let northPdgts;  
          let diffusedDigits;
         if(containsDigit(input)){
             digitsPln = getDigits(input);
             northPdgts = new North(digitsPln);   
             diffusedDigits = northPdgts.getOrbitAt(4, 0);
         }else{
             alert('No plaintext digits(s) to encrypt');            
         }
         
          let digitsKey='';
          let myExpandedDigitsKey='';
        if(containsDigit(key)){
             digitsKey = getDigits(key); 
            myExpandedDigitsKey = getVPlusPlusKey(digitsKey);
         }else{
             alert('No digit(s) key to encrypt plaintext digit');          
         }
                                   
        let myVppD; 
        let encryptedDigits='';
        
        // diffuse the digits
          alert('entered Digits: '+digitsPln.length);
                
            myVppD = new VPlusPlus(diffusedDigits, myExpandedDigitsKey);             
            encryptedDigits = myVppD.getEncryptedDigits();   
           
      } // containsDigit();
       
         alert(lettersPln.length+'LAST');
          document.getElementById("output").value = format(encryptedLetters, encryptedDigits);
          
     }else if (dchecked==true && impchecked==true){
        // Using the implementations
        
     }else if (dchecked==false){// Vigenère Cipher Encryption
      
     let input = document.getElementById("input").value;
     let key = document.getElementById("key").value;
         
         if (!input || !key) {
             alert("Please enter both text and key.");
             return;
         }
         if(containsLetter(input) && containsLetter(key)){
          input = getLetters(input);
          key = getLetters(key);
          let myVigenere = new Vigenere(input, key);
        
          alert('entered VIGENERE');
        document.getElementById('output').value = format(myVigenere.getEncryptedLetters(), digits);
       }else{
           alert('Enter both plaintext and key in letters');
       }// containsLetter()
     }
   } // encrypt()


  // Decryption function

   function decryptText(){
     let dchecked = document.getElementById('diffusion_option').checked;
      let impchecked = document.getElementById('implementation_option').checked;

      let input = document.getElementById("input").value.trim();
      let key = document.getElementById("key").value.trim();
       
      if (!input || !key) {
             alert("Please enter both text and key.");
             return;
       }
       
      if(dchecked==true && impchecked==false){
        
        
          
          
      }else if (dchecked==true && impchecked==true){
        // Using the implementations
        
      }else if (dchecked==false){// Vigenère Cipher Decryption
          
     let input = document.getElementById("input").value.trim().toUpperCase();
     let key = document.getElementById("key").value.trim().toUpperCase();
      input = getLetters(input);
      key = getLetters(key); 
      const myVigenere = new Vigenere(input, key);
      document.getElementById('output').value = format(myVigenere.getDecryptedLetters(),'');
   }
  } // decrypt()
    
    
    function containsLetter(text){
        let result = false;
        for(let i = 0; i < text.length; i++){
            if(isLetter(text[i])){
                result = true;
                break;
            }
        }
            return result;
    }
    
    function containsDigit(text){
        let result = false;
        for(let i = 0; i < text.length; i++){
            if(isDigit(text[i])){
                result = true;
                break;
            }
        }
            return result;
    }
    
// diffusion functions
    function getNorthDiffusion(message){
       let orbitIndex = document.getElementById('orbitIndex').value;
       let diffIndex = document.getElementById('diffIndex').value;
        
        let north = new North(message);
        return north.getOrbitAt(orbitIndex, diffIndex);
    }
    
    function getEastDiffusion(message){
        let orbitIndex = document.getElementById('orbitIndex').value;
        let diffIndex = document.getElementById('diffIndex').value;
        
        let east = new East(message);
        return east.getOrbitAt(orbitIndex, diffIndex);
    }
    
    function getWestDiffusion(message){
        let orbitIndex = document.getElementById('orbitIndex').value;
        let diffIndex = document.getElementById('diffIndex').value;
        
        let west = new West(message);
        return west.getOrbitAt(orbitIndex, diffIndex);
    }
    
    function getSouthDiffusion(message){
        let orbitIndex = document.getElementById('orbitIndex').value;
        let diffIndex = document.getElementById('diffIndex').value;
        
        let south = new South(message);
        return south.getOrbitAt(orbitIndex, diffIndex);
    }
    
    function getNorthRDiffusion(message){
        let orbitIndex = document.getElementById('orbitIndex').value;
        let diffIndex = document.getElementById('diffIndex').value;
        
        let northR = new NorthReversed(message);
        return northR.getOrbitAt(orbitIndex, diffIndex);
    }
    
    function getEastRDiffusion(message){
        let orbitIndex = document.getElementById('orbitIndex').value;
        let diffIndex = document.getElementById('diffIndex').value;
        
        let eastR = new EastReversed(message);
        return eastR.getOrbitAt(orbitIndex, diffIndex);
    }
    
    function getWestRDiffusion(message){
        let orbitIndex = document.getElementById('orbitIndex').value;
        let diffIndex = document.getElementById('diffIndex').value;
        
        let westR = new WestReversed(message);
        return westR.getOrbitAt(orbitIndex, diffIndex);
    }
    
    function getSouthRDiffusion(message){
        let orbitIndex = document.getElementById('orbitIndex').value;
        let diffIndex = document.getElementById('diffIndex').value;
        
        let southR = new SouthReversed(message);
        return southR.getOrbitAt(orbitIndex, diffIndex);
    }
    
    function test(){
      k =  getOutWardDiffusion('WASSAH', 'N', 0);
      alert(k);
    }
    
    // implementation (diffusion) functions
    function getOutWardDiffusion(message, functionDiff){
        
      //  checkDiffusionOption();
        alert('entered outward');
        let newDiffusedText = ""; //store diffused intermediate chars
 
        let outWardDiffused ='';
        
        let strLen = message.length;
        let maxIter = (strLen) / 2; //maximum iteration for the while loop
        let start =  maxIter - 1; // start index
        let end = maxIter+1; // end index

        if(strLen%2==1){
            end++;
        }
         let iter=maxIter;
       // while loop
        while(iter>0){

            let extract = message.substring(start,end);
            // diffuse collected subText
            newDiffusedText = newsDiffuseExtract(extract, functionDiff);

            //replace corresponding newDiffusedText into newText
            let textInChars = message.split('');
            let dLen = newDiffusedText.length;
            let start1 = start;
            let j=0;
            while(dLen>0){
                //replace chars with diffused txt at
                textInChars[start1] = newDiffusedText[j];
                start1++;
                j++;
                dLen--;
            }//while
            message = textInChars.join('');
            start--;
            end++;
        iter--;
            
    }// while
        outWardDiffused = message;
         return outWardDiffused;
        
  } // outWardDiffuse()
    
    function getInWardDiffusion(message, functionDiff){
        
    }
    
    function getRightWardDiffusion(message, functionDiff){
        
    }
    
    function getRightWardRDiffusion(message, functionDiff){
        
    }
    
    function getLeftWardDiffusion(message, functionDiff){
        
    }
    
    function getLeftWardRDiffusion(message, functionDiff){
        
    }
    
    function newsDiffuseExtract(message){
        let diffusedIntermediateChars = '';
        if(functionDiff.toUpperCase()=='N'){           
            diffusedIntermediateChars = getNorthDiffusion(message);
        }else if(functionDiff.toUpperCase()=='E'){     
            diffusedIntermediateChars = getEastDiffusion(message);
        }else if(functionDiff.toUpperCase()=='W'){
            diffusedIntermediateChars = getWestDiffusion(message);
        }else if(functionDiff.toUpperCase()=='S'){
            diffusedIntermediateChars = getSouthDiffusion(message);
        }else if(functionDiff.toUpperCase()=='NR'){           
            diffusedIntermediateChars = getNorthRDiffusion(message);
        }else if(functionDiff.toUpperCase()=='ER'){           
            diffusedIntermediateChars = getEastRDiffusion(message);
        }else if(functionDiff.toUpperCase()=='WR'){           
            diffusedIntermediateChars = getWestRDiffusion(message);
        }else if(functionDiff.toUpperCase()=='SR'){           
            diffusedIntermediateChars = getSouthRDiffusion(message);
        }else{
           alert('Wrong diffusion option');
             return;
        }
        return diffusedIntermediateChars;
    }
    // let functionDiff;
    function checkDiffusionOption(){
        if(!(functionDiff=="N" || functionDiff=="NR" || functionDiff=="E"  || functionDiff=="ER" || functionDiff=="W" || functionDiff=="WR" || functionDiff=="S" || functionDiff=="SR")){
            alert("enter valid diffusion option");
            return;
        }
    }
    

    function getVPlusPlusKey(key){
       let input = document.getElementById("input").value.trim();
       let key = document.getElementById("key").value.trim();

    // marchCheck();
      let generatedLettersKey = '';
      let generatedDigitsKey = '';
        
        // for letters
        let lettersPln='';
        let lettersKey ='';
        
        // for digits
        let  digitsPln='';
        let digitsKey='';
        
        let north;
        let keyExpanded;
        
     if(containsLetter(key) && containsLetter(input)){
        lettersPln = getLetters(input);
        lettersKey = getLetters(key);         
        north = new North(lettersKey);
        keyExpanded = north.getFirstOrbit(0);    
             
       while(keyExpanded.length < lettersPln.length){
         north = new North(keyExpanded);
         keyExpanded+=north.getFirstOrbit(0);             
        }
         
       north = new North(keyExpanded.slice(0, lettersPln.length));
        generatedLettersKey = north.getOrbitAt(6, 0);
         return generatedLettersKey;
      }else if(containsDigit(key) && containsDigit(input)){
        digitsPln = getDigits(input);
        digitsKey = getDigits(key);
        north = new North(digitsKey);
        keyExpanded = north.getFirstOrbit(0);    
          
       while(keyExpanded.length < digitsPln.length){
         north = new North(keyExpanded);
         keyExpanded+=north.getFirstOrbit(0);             
      }
        north = new North(keyExpanded.slice(0, digitsPln.length));
       generatedDigitsKey = north.getOrbitAt(6, 0);
           return generatedDigitsKey;
      } // if sttmnt
      
    }


   function showGeneratedKey(){
       let input = document.getElementById("input").value;
       let key = document.getElementById("key").value;
       
       if (!input || !key) {
           alert("Please enter both text and key.");
           return;
        }
       let lettersKey='';
       let inputL ='';
       let keyL ='';
       if(containsLetter(input) && containsLetter(key)){
       inputL = getLetters(input);
       keyL = getLetters(key);
       lettersKey = getVPlusPlusKey(keyL);
       }
       let digitsKey='';
       let inputD ='';
       let keyD ='';
       if(containsDigit(input) && containsDigit(key)){
       inputD = getDigits(input);
       keyD = getDigits(key);
       digitsKey=getVPlusPlusKey(keyD);
       }
       
       let dchecked = document.getElementById('diffusion_option').checked;
       
       if(dchecked==false){
         const myVigenere = new Vigenere(input, key);       
         alert(myVigenere.getRepeatedKey(input, key));
       }else{
         alert(lettersKey+' '+digitsKey);
       }
     }

     // Extract letters from input
     function getLetters(myLetters){
        
        let extractedLetters ="";
        
        if (!myLetters) {
        alert("Please provide a text.");
        return;
        }
        
        for(let i=0; i<myLetters.length; i++){
            
          if(this.isLetter(myLetters[i])) {
            extractedLetters += myLetters[i];
            }else{
                continue;
            }
        }
        
        return extractedLetters;
    }

    // Checks if given character is a letter
   function isLetter(myChar){
        myChar = myChar.toUpperCase();
        let result = false;
          if(myChar.charCodeAt(0) >= 65 && myChar.charCodeAt(0) <= 91){
            
              result = true;
            }
        return result;
    }

    // Extract digits from input
   function getDigits(myDigit){
      let extractedPlainDigits ="";
        
        if (!myDigit) {
        alert("Please enter both text and key.");
        return;
        }
        
        for(let i=0; i<myDigit.length; i++){
            
          if(this.isDigit(myDigit[i])) {
            extractedPlainDigits += myDigit[i];
            }else{
                continue;
            }
        }
        
        return extractedPlainDigits;
  }
    
   function isDigit(myChar){
       let result = false;
          if(myChar.charCodeAt(0) >= 48 && myChar.charCodeAt(0) <= 57){
              result = true;
            }
        return result;
   }
    
    function format(encryptedLetters, encryptedDigits){
        
           const input = document.getElementById("input").value.trim();
 
            let letterCount = 0;
            let digitCount = 0;
            
            let myFormatArray = new Array();
            
            for (let i = 0; i < input.length; i++) {
                
                if(isLetter(input[i])) {
                                       
                          if (input[i] === input[i].toUpperCase()) {
                            myFormatArray.push(encryptedLetters[letterCount].toUpperCase());
                            letterCount++;
                          } else {
                              myFormatArray.push(encryptedLetters[letterCount].toLowerCase());
                            letterCount++;
                          }
                          
                 } else if (isDigit(input[i])){
                        myFormatArray.push(encryptedDigits[digitCount]);
                        digitCount++;             
                }else{
                    myFormatArray.push(input[i]); // Non-alphabetic or non-digits characters remain unchanged
                }
                
            }// for loop

        return myFormatArray.join("");
    }// format()
    
    </script>
</body>
</html>
